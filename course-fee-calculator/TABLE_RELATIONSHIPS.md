# æ•°æ®åº“è¡¨å…³ç³»å›¾

## ğŸ”— è¡¨å…³ç³»è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  schedule_data  â”‚â”€â”€â”€â–¶â”‚processed_schedule_dataâ”‚â—€â”€â”€â”€â”‚    students     â”‚
â”‚   (åŸå§‹æ•°æ®)     â”‚    â”‚    (å¤„ç†åæ•°æ®)        â”‚    â”‚   (å­¦ç”Ÿæ¡£æ¡ˆ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    modification_logs                            â”‚
â”‚                      (ä¿®æ”¹æ—¥å¿—)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ è¯¦ç»†å…³ç³»è¯´æ˜

### 1. æ•°æ®æµå‘å…³ç³»

#### `schedule_data` â†’ `processed_schedule_data`
- **å…³ç³»ç±»å‹**ï¼šæ•°æ®è½¬æ¢
- **è¯´æ˜**ï¼šåŸå§‹æ•°æ®ç»è¿‡æ™ºèƒ½å¤„ç†åå­˜å‚¨åˆ°å¤„ç†è¡¨
- **å…³é”®å­—æ®µ**ï¼š`name`, `date`, `title`

#### `students` â†’ `processed_schedule_data`
- **å…³ç³»ç±»å‹**ï¼šæ•°æ®åŒ¹é…
- **è¯´æ˜**ï¼šå­¦ç”Ÿæ¡£æ¡ˆç”¨äºåŒ¹é…å’Œè¡¥å……è¯¾ç¨‹æ•°æ®
- **å…³é”®å­—æ®µ**ï¼š`name` (å­¦ç”Ÿå§“å)

#### æ‰€æœ‰è¡¨ â†’ `modification_logs`
- **å…³ç³»ç±»å‹**ï¼šå®¡è®¡è¿½è¸ª
- **è¯´æ˜**ï¼šè®°å½•æ‰€æœ‰è¡¨çš„ä¿®æ”¹å†å²
- **å…³é”®å­—æ®µ**ï¼š`table_name`, `record_id`

### 2. å­—æ®µå…³è”å…³ç³»

#### å­¦ç”Ÿå§“åå…³è”
```sql
-- students.name = processed_schedule_data.name
-- ç”¨äºåŒ¹é…å­¦ç”Ÿæ¡£æ¡ˆå’Œè¯¾ç¨‹æ•°æ®
```

#### æ—¶é—´å…³è”
```sql
-- processed_schedule_data.created_at
-- ç”¨äºæŒ‰æ—¶é—´æ’åºæ˜¾ç¤ºæ•°æ®
```

#### è´¹ç”¨è®¡ç®—å…³è”
```sql
-- processed_schedule_data.fee_total = fee Ã— hours
-- è‡ªåŠ¨è®¡ç®—å­—æ®µ
```

## ğŸ¯ ä¸šåŠ¡é€»è¾‘å…³ç³»

### æ•°æ®è¾“å…¥æµç¨‹
1. **åŸå§‹è¾“å…¥** â†’ `schedule_data`
2. **æ™ºèƒ½å¤„ç†** â†’ åŒ¹é… `students` è¡¨
3. **æ•°æ®å®Œå–„** â†’ `processed_schedule_data`
4. **å˜æ›´è®°å½•** â†’ `modification_logs`

### æ•°æ®æŸ¥è¯¢æµç¨‹
1. **ç”¨æˆ·æŸ¥è¯¢** â†’ `processed_schedule_data`
2. **å­¦ç”Ÿä¿¡æ¯** â†’ å…³è” `students` è¡¨
3. **å†å²è®°å½•** â†’ æŸ¥è¯¢ `modification_logs`

### æ•°æ®ç»´æŠ¤æµç¨‹
1. **å­¦ç”Ÿæ¡£æ¡ˆæ›´æ–°** â†’ `students` è¡¨
2. **è¯¾ç¨‹æ•°æ®å¤„ç†** â†’ `processed_schedule_data`
3. **å˜æ›´è¿½è¸ª** â†’ `modification_logs`

## ğŸ” å…³é”®æŸ¥è¯¢å…³ç³»

### æŒ‰å®¶é•¿åˆ†ç»„æŸ¥è¯¢
```sql
SELECT 
    p.parent,
    s.fee,
    COUNT(*) as lesson_count,
    SUM(p.fee_total) as total_amount
FROM processed_schedule_data p
JOIN students s ON p.name = s.name
GROUP BY p.parent, s.fee
ORDER BY total_amount DESC;
```

### å­¦ç”Ÿè¯¾ç¨‹å†å²
```sql
SELECT 
    p.name,
    p.date,
    p.hours,
    p.fee_total,
    s.parent,
    s.graduated
FROM processed_schedule_data p
JOIN students s ON p.name = s.name
WHERE p.name = 'Aahana'
ORDER BY p.date DESC;
```

### è´¹ç”¨ç»Ÿè®¡æŸ¥è¯¢
```sql
SELECT 
    DATE_TRUNC('month', p.date) as month,
    COUNT(*) as total_lessons,
    SUM(p.fee_total) as total_revenue
FROM processed_schedule_data p
GROUP BY DATE_TRUNC('month', p.date)
ORDER BY month DESC;
```

## ğŸ“Š æ•°æ®å®Œæ•´æ€§çº¦æŸ

### å¿…éœ€å…³ç³»
1. **å­¦ç”Ÿå­˜åœ¨æ€§**ï¼š`processed_schedule_data.name` å¿…é¡»åœ¨ `students.name` ä¸­å­˜åœ¨
2. **è´¹ç”¨ä¸€è‡´æ€§**ï¼š`processed_schedule_data.fee` åº”è¯¥ä¸ `students.fee` ä¸€è‡´
3. **å®¶é•¿ä¸€è‡´æ€§**ï¼š`processed_schedule_data.parent` åº”è¯¥ä¸ `students.parent` ä¸€è‡´

### å¯é€‰å…³ç³»
1. **æ—¶é—´é€»è¾‘**ï¼š`startdate` â‰¤ `enddate`
2. **è´¹ç”¨è®¡ç®—**ï¼š`fee_total` = `fee` Ã— `hours`
3. **çŠ¶æ€ä¸€è‡´æ€§**ï¼š`graduated` çŠ¶æ€åº”è¯¥åˆç†

## ğŸ› ï¸ ç»´æŠ¤å…³ç³»

### æ•°æ®åŒæ­¥
- å½“ `students` è¡¨æ›´æ–°æ—¶ï¼Œç›¸å…³çš„ `processed_schedule_data` è®°å½•å¯èƒ½éœ€è¦æ›´æ–°
- å½“åˆ é™¤å­¦ç”Ÿæ¡£æ¡ˆæ—¶ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦ä¿ç•™å†å²è¯¾ç¨‹è®°å½•

### æ•°æ®æ¸…ç†
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ `schedule_data` è®°å½•
- å½’æ¡£æ—§çš„ `modification_logs` è®°å½•
- ç»´æŠ¤ `processed_schedule_data` çš„æ•°æ®è´¨é‡

### æ€§èƒ½ä¼˜åŒ–
- åœ¨å…³è”å­—æ®µä¸Šåˆ›å»ºç´¢å¼•
- è€ƒè™‘è¡¨åˆ†åŒºç­–ç•¥
- ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
